model PriceList {
  id        String        @id @default(cuid())
  tenantId  String
  storeId   String?
  code      PriceListCode
  name      String
  currency  String        @default("PEN")
  isActive  Boolean       @default(true)

  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  tenant    Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  store     Store?        @relation(fields: [storeId], references: [id], onDelete: SetNull)

  prices    ItemPrice[]
  tiers     ItemPriceTier[]

  @@unique([tenantId, storeId, code])
  @@index([tenantId])
  @@index([storeId])
  @@index([tenantId, isActive])
  @@index([tenantId, code])
}

model ItemPrice {
  id          String   @id @default(cuid())
  tenantId    String
  itemId      String

  variantId   String?

  priceListId String
  amount      Decimal  @db.Decimal(12, 4)

  validFrom   DateTime @default(now())
  validTo     DateTime?

  createdBy   String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  item        Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  priceList   PriceList @relation(fields: [priceListId], references: [id], onDelete: Cascade)
  variant     ItemVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([itemId])
  @@index([priceListId])
  @@index([itemId, priceListId, validFrom, validTo])
  @@index([variantId, priceListId, validFrom, validTo])
}

model ItemPriceTier {
  id          String   @id @default(cuid())
  tenantId    String
  itemId      String

  variantId   String?

  priceListId String
  minQty      Int

  price       Decimal  @db.Decimal(12, 4)

  createdAt   DateTime @default(now())

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  item        Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  priceList   PriceList @relation(fields: [priceListId], references: [id], onDelete: Cascade)
  variant     ItemVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, itemId, variantId, priceListId, minQty])
  @@index([tenantId])
  @@index([itemId])
  @@index([variantId])
  @@index([priceListId])
}
